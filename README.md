# Kubernetes の用語
例 ： Kubernetesが、マンション管理システムだと考えると

| 単語       | 略称    | 説明 (Description)         | 例：マンション管理システム   |
|------------|--------|----------------------------|----------------------------|
| Cluster    | -      | 環境全体                    | マンションの全体            |
| Node       | no     | 物理/仮想マシン             | マンションの各階            |
| Pod        | po     | コンテナを動かす最小単位     | 各階の各部屋                |
| Container  | -      | アプリケーション実行環境     | 各部屋の住人                |
| Deployment | deploy | Podを管理するコントローラー  | 部屋の管理人（空室を補充）   |
| Service    | svc    | Podのアクセスエンドポイント  | 受付                       |


```
┌─────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                      Kubernetes Cluster                                         │
│  ┌───────────────────────────────┐  ┌────────────────────────────────────────────────────────┐  │
│  │    Node (Control Plane)       │  │                   Node (Worker Node)                   │  │
│  │  - API Server                 │  │                                                        │  │
│  │  - Scheduler                  │  │  ┌──────────────────────────────────────────────────┐  │  │
│  │  - Controller Manager         │  │  │                   Deployment                     │  │  │
│  │  - etcd (data store)          │  │  │                  (manages Pods)                  │  │  │
│  │                               │  │  └────────────────────────┬─────────────────────────┘  │  │
│  │                               │  │                           │ manages                    │  │
│  │                               │  │                           ↓                            │  │
│  │                               │  │  ┌──────────────────────────────────────────────────┐  │  │
│  │                               │  │  │                     Service                      │  │  │
│  │                               │  │  │                  (access point)                  │  │  │
│  │                               │  │  └────────────────────────┬─────────────────────────┘  │  │
│  │                               │  │                           │ routes to                  │  │
│  │                               │  │                           ↓                            │  │
│  │                               │  │  ┌──────────────────────────────────────────────────┐  │  │
│  │                               │  │  │       Pod1            Pod2            Pod3       │  │  │
│  │                               │  │  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  │  │  │
│  │                               │  │  │  │ Containers │  │ Containers │  │ Containers │  │  │  │
│  │                               │  │  │  └────────────┘  └────────────┘  └────────────┘  │  │  │
│  │                               │  │  │                                                  │  │  │
│  │                               │  │  └──────────────────────────────────────────────────┘  │  │
│  └───────────────────────────────┘  └────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                ↑
                                      Controlling with kubectl
```

## 1. Cluster
Clusterは、Kubernetesの環境全体のことです。複数のNodeから構成されます。

## 2. Node
Nodeは、物理的または仮想的なマシンです。コンテナを実行する場所です。

Nodeには、２つの種類があります。
- Control Plane : クラスタを管理する Node
- Worker Node   : 実際にアプリを動かす Node

環境によっては、１つのNodeが2つの役割を兼任します。

物理的に複数PCを使ってKubernetes環境をつくるとき、1つのPCが1つのNodeを担います。

## 3. Pod
Podは、コンテナを動かす最小単位です。

次の特徴があります。
* 通常、1Podに1コンテナを配置します。複数コンテナを配置することもできます。
* 同じPod内のコンテナは、同じIPアドレスを共有します。
* Podは一時的（ephemeral）です。壊れたら新しいものを作り直します。
* Pod単体で作成することもできますが、実運用では Deployment 経由で管理します。

## 4. Deployment
Podは、Deploymentを介して管理します。

次の特徴があります。
* Deploymentは、指定した数のPodを維持する
* Deploymentは、Podが壊れたら自動で再作成します。
* Deploymentを使うことで、ローリングアップデート（無停止更新）が可能です。

## 5. Service
Serviceは、Podへの固定のエンドポイントを提供します。

なぜなら、Podは使い捨てなので、IPアドレスが毎回変わるため。

例：

3つのpodsにnginxをデプロイした時、クライアントからServiceへアクセスするイメージ

Serviceは、受信したリクエストをランダム（デフォルト）にPodへ振り分ける。


```
              Service
             ( 固定IP )
                 ↓
           ロードバランサー
          ↙      ↓        ↘
     Pod1      Pod2       Pod3
  ( 可変IP ) ( 可変IP ) ( 可変IP )
```

## 6. スケーリング
スケーリングは、Podの数を増減することです。
* スケールアウト : Podの数を増やす
* スケールイン　 : Podの数を減らす

